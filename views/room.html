<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Driv.in - social video experience in a digital drive-in</title>

    <meta name="description" content="">
    <meta name="author" content="Go Horse Brazil">

    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nunito" type="text/css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/drivin.css">

    <!-- libs -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/jquery-1.6.2.min.js"></script>

    <!-- divin code -->
    <script src="js/drivin.js"></script>
    <script src="js/drivin-chat.js"></script>
    <script src="js/drivin-player.js"></script>
    <script src="js/drivin-playlist.js"></script>
    <script src="js/drivin-video.js"></script>
    <script src="js/drivin-room.js"></script>
    <script src="js/drivin-user.js"></script>
</head>

<body>

<div id="drive-in">

    <section id="stage">
        <h1>Driv.in</h1>
        
        <a id="button-mute" href="#mute">mute sound</a>

        <script>
            $( 'a#button-mute' ).click(function () {
                $(this).toggleClass( 'muted' );
                return false;
            });
        </script>


        <div id="video-player">
            <input type="text" id="room-title" name="" value="NodeKO 2011" readonly>
            <object type="application/x-shockwave-flash" id="diplayer" data="http://www.youtube.com/apiplayer?version=3&enablejsapi=1&playerapiid=player1" width="540" height="332">
                <param name="allowScriptAccess" value="always">
                <param name="wmode" value="transparent">
            </object>
        </div>

        <div id="video-audience">
            <div id="user-space"></div>
        </div>

        <script>
            currentUser = new User( {name:'lquixada', avatar:'img/avatar01.png'} );

            room.init();
            room.add( currentUser );
            room.add( new User( {name:'cainanunes', avatar:'img/avatar01.png'} ) );
            room.add( new User( {name:'emerleite', avatar:'img/avatar01.png'} ) );
            room.add( new User( {name:'everton', avatar:'img/avatar01.png'} ) );
        </script>

    </section>

    <aside id="panels">

        <section id="playlist">
            <header>
                <h2>Playlist</h2>
            </header>

            <section id="playlist-now">
                <h3>Now</h3>

                <marquee scrolldelay="150" class="video-name">
                  <% if(room.playing()){ %>
                    <%= room.currentMedia.title %>
                  <% } %>
                </marquee>
                <span class="video-duration">
                  <% if(room.playing()){ %>
                    <%= room.currentMedia.duration %>
                  <% } %>
                </span>
                <a class="button-tomatoes" href="#tomato">throw tomatoes</a>
                <!--<button style="margin:0; width:100%; height:60px;"></button>-->
            </section>

            <section id="playlist-queue">
                <h3>Next</h3>

                <ul>
                  <% playlist.forEach(function(media){ %>
                    <li id="<%= media.id %>">
                        <a href="<%= media.url %>" target="_blank">
                            <img src="<%= media.thumbUrl %>" width="47" height="35">
                            <%= media.title %>
                        </a>
                    </li>
                  <% });%>
                </ul>
            </section>

            <footer>
                <input type="text" id="video-url" name="video_url" value="" placeholder="paste a video url from youtube">
                <button type="button" id="video-add">add video</button>
            </footer>
        </section>

        <section id="chat">
            <header>
                <h2>Chat</h2>

                <div id="user-info">
                    <input type="text" id="user-name" maxlength="20" placeholder="enter a username">
                    <button type="button">avatar</button>
                </div>
            </header>

            <section id="chat-messages">
                
                <ul>
                    <li><strong>emerson leite</strong> esse node...</li>
                    <li><strong>everton</strong> eu sou lá de pelotas</li>
                    <li><strong>lquixada</strong> hmmmm!!!!!</li>
                    <li><strong>cainanunes</strong> quixadáááááá</li>
                    <li><strong>lquixada</strong> whazzzuuuuup</li>
                    <li><strong>cainanunes</strong> mas bah! mecaiu os butiá dos bolso</li>
                    <li><strong>emerson leite</strong> esse node...</li>
                    <li><strong>everton</strong> eu sou lá de pelotas</li>
                    <li><strong>lquixada</strong> hmmmm!!!!!</li>
                    <li><strong>cainanunes</strong> quixadáááááá</li>
                    <li><strong>lquixada</strong> whazzzuuuuup</li>
                    <li><strong>cainanunes</strong> mas bah! mecaiu os butiá dos bolso</li>
                </ul>
            </section>

            <footer>
                <input type="text" id="message" name="message" maxlength="80" placeholder="send a message">
            </footer>

            <script>
                  var playerReady = false;
                  var socket = io.connect();
                  var room = '<%= room.name %>'

                  joinRoom();

                  socket.on('connect', function() {
                    socket.connected = true;
                  });

                  playlist.init();
                  chat.init( {
                      onMessageSent: function ( message ) {
                          this.addMessage( currentUser.name, message );

                          currentUser.speak( message );
                          /* insert here command for socket to broadcast the message */
                      },
                      onUserNameChanged: function ( userName ) {
                          currentUser.name = userName;
                      }
                  });

                  video.init();
            </script>
        </section>
    </aside>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25382569-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>

</html>
